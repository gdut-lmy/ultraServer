# ultraServer

学习ultra高性能服务器框架

##当前进度
| 日期        |        进度        |
|-----------|:----------------:|
| 2022-9-28 |   创建项目结构，项目初始化   |
| 2022-9-29 |      完成日志模块      |
| 2022-10-5 | 完善util模块与macro模块 |
| 2022-10-8 |     完成环境配置模块     |
| 2022-10-9 |   融合日志模块与配置模块    |





## 模块概述

### 日志模块

支持流式日志风格写日志和格式化风格写日志，支持日志格式自定义，日志级别，多日志分离等功能。

流式日志使用示例：

```cpp
ULTRA_LOG_INFO(g_logger) << "message";
```

c风格格式化日志使用示例：
```cpp
ULTAR_LOG_FMT_INTO(g_logger,"%s","this is a log");
```
### 配置模块
用于定义、声明配置项，并且从配置文件中加载用户配置。

#### 配置模块设计
简单来说，约定优于配置的背景条件是，一般来说，程序所依赖的配置项都有一个公认的默认值，也就是所谓的约定。这点有可许多可以参考的例子，比如对于一个http网络服务器，服务端口通常都是80端口，对于配置文件夹路径，一般都是conf文件夹，对于数据库目录，一般都是db或data文件夹。对于这些具有公认约定的配置，就不需要麻烦程序员在程序跑起来后再一项一项地指定了，而是可以初始时就将配置项设置成对应的值。这样，程序员就可以只修改那些约定之外的配置项，然后以最小的代价让程序跑起来。

约定优于配置的方式可以减少程序员做决定的数量，获得简单的好处，同时兼顾灵活性。

在代码上，约定优于配置的思路体现为所有的配置项在定义时都带一个的默认值，以下是一个ultra配置项的示例，这是一个int类型的配置项，名称为tcp.connect.timeout，初始值为5000。

```cpp
static ultra::ConfigVar<int>::ptr g_tcp_connect_timeout = ultra::Config::Lookup("tcp.connect.timeout", 5000, "tcp connect timeout");
```

ultra的配置项定义之后即可使用，比如上面的配置项可以直接使用g_tcp_connect_timeout->getValue()获取参数的值，这里获取的为默认值5000。

ultra使用YAML做为配置文件，配置名称大小写不敏感，并且支持级别格式的数据类型，比如上面的配置项对应的YAML配置文件内容如下：

```yaml
tcp:
    connect:
        timeout: 10000
```

这里指定了配置名称为 tcp.connect.timeout的配置项的值为10000。由于配置文件指定的值与默认值不一样，当配置文件加载后，对应的配置项值会被自动更新为10000，如果配置项还注册了配置变更回调函数的话，会一并调用配置变更回调函数以通知配置使用方。

ultra支持STL容器（vector, list, set, map等等），支持自定义类型（需要实现序列化和反序列化方法)。

#### 配置模块实现

使用YAML解析库，核心技术使用仿函数的偏特化实现。